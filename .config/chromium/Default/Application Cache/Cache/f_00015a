Type.registerNamespace("_im");function IMComponent(){}IMComponent.prototype={$1aH:function(n,t,i){var r=this;n.$Ax(_im.$EG).$AHn().$AHo(function(){return new _im.$EG});var u=this;n.$Ax(_h.$yo).$AHn().$AHo(function(){return new _im.$1F7(n.$2AC(_y.$GP))});var f=this;n.$Ax(IChatManagerFactory).$AHn().$AHo(function(){var t=i.get_$9Z()==="Mouse"&&!_a.$Cu.$yQ();return new _im.$14C(t,n.$2AC(_im.$EG),n.$2AC(_a.$3k),null,n.$2AC(_0365f.$L),n.$2AC(_g.$V),i.get_$9l())});var e=this;n.$Ax(_im.$2b).$AHn().$AHo(function(){return n.$2AC(IChatManagerFactory).$E()});var o=this;n.$Ax(IChatActionFactory).$AHn().$AHo(function(){var t;t=i.get_$1Ea()?new _im.$11f(n.$2AC(_im.$2b),n.$2AC(_h.$yo)):new _im.$11f(n.$2AC(_im.$2b),null);return new _im.$14B(t,new _im.$163(n.$2AC(_im.$2b)))});var s=this;n.$Ax(_im.$oy).$AHm(IChatViewModelFactory).$AHo(function(){return new _im.$oy(n.$2AC(_y.$N),n.$2AC(_y.$T7),n.$2AC(_y.$GP))});if(i.get_$1Ea()){var c=this;n.$Ax(_im.$10T).$AHm(IPresenceManager).$AHn().$AHo(function(){return new _im.$10T(n.$2AC(_im.$2b),n.$2AC(_im.$EG),n.$2AC(_y.$GP))})}else{var h=this;n.$Ax(_im.$Ht).$AHm(IPresenceManager).$AHn().$AHo(function(){return new _im.$Ht(n.$2AC(_im.$2b),n.$2AC(_im.$EG),n.$2AC(_y.$GP))})}var l=this;n.$Ax(IChatProviderFactory).$AHn().$AHo(function(){return new _im.$14F(i.get_$9Z()==="Mouse"&&!_a.$Cu.$yQ(),n.$2AC(_im.$2b),n.$AGW(IPresenceManager),n.$AGW(IChatActionFactory))});var a=this;n.$Ax(_im.$ox).$AHn().$AHo(function(){return new _im.$ox(i.get_$9Z(),n.$2AC(_g.$V).get_$5eM(),n.$2AC(_im.$2b),n.$2AC(_im.$oy))})},$82P:function(){return[new _a.$6K(_im.$ox,1,1),new _a.$6K(_im.$2b,2,9)]}};_im.$ox=function(n,t,i,r){if(n==="Mouse"&&t){var u=this;i.get_$7XW().add_$1Y(function(n,t){if(!t.$2Z)for(var i=0;i<t.$2q.length;i++){var u=t.$2q[i];r.$9eS(u)}})}};_im.$HP=function(n,t,i,r){this.$$d_$5Dw=Function.createDelegate(this,this.$5Dw);this.$$d_$9XF=Function.createDelegate(this,this.$9XF);this.$$d_$6N1=Function.createDelegate(this,this.$6N1);_im.$HP.initializeBase(this);this.$S3=r;this.$7a=n;this.$E4=new _C(this.$$d_$6N1,_a.$0.$4c);this.set_$28S(i.$mj(1,_y.$17.$XR,this.$7a.get_$Qc(),1));this.$7a.get_$Qc().add_$1Y(this.$$d_$9XF);t.add_$UA(this.$$d_$5Dw);if(r.get_mainWindowInstance()&&!r.get_mainWindowInstance().closed){var u=this;_a.$42.$Gf(r.get_mainWindowInstance(),function(n){n.chatWindowReady(u.$7a.get_$Q())})}};_im.$HP.prototype={$S3:null,$7a:null,$E4:null,$J8:null,$4V1:null,get_$28S:function(){return this.$W(_im.$HP.$4Rx)},set_$28S:function(n){this.$M(_im.$HP.$4Rx,n);return n},get_$2fB:function(){return this.$W(_im.$HP.$4Zp)},set_$2fB:function(n){this.$M(_im.$HP.$4Zp,n);return n},get_$Nu:function(){return this.$4V1},set_$Nu:function(n){this.$4V1=n;$3(this,"RawEditorContent");return n},$9XF:function(n,t){switch(t.$2Z){case 0:for(var i=0;i<t.$2q.length;i++){var f=t.$2q[i];this.get_$28S().$1rU(f)}return;case 2:for(var r=t.$3B.length-1;r>=0;r--){var e=t.$3B[r];var o=this;var u=this.get_$28S().$1U.$Dn(function(n){var t=n;return t.$CB.get_$Al()===e.get_$Al()});u<this.get_$28S().$1U.get_$C()&&this.get_$28S().$1U.$6C(u)}return}},$6N1:function(){if(!_js.$8.$a(this.get_$2fB())){this.$7a.$A0p(this.get_$2fB());var n=this;_a.$42.$Gf(this.$S3.get_mainWindowInstance(),function(t){t.sendChatMessage(n.$7a.get_$1y().Id,n.get_$2fB())})}},$5Dw:function(n){_js.Trace.logInfo(_a.$0.$4c,"ChatViewModel.BeforeUnload invoked.");this.$7a.get_$Qc().remove_$1Y(this.$$d_$9XF);var t=this;_a.$42.$Gf(this.$S3.get_mainWindowInstance(),function(n){_js.Trace.logInfo(_a.$0.$4c,"ChatViewModel.BeforeUnload calling into main window.");n.endChat(t.$7a.get_$Q())})}};_im.$oy=function(n,t,i){this.$B=n;this.$7F=t;this.$S3=i};_im.$oy.prototype={$B:null,$7F:null,$S3:null,$9eS:function(n){var i={};i.ItemID=n.get_$i();var r=new _y.$PJ;r.set_$4c(n);var t=_y.$48.get_$8FM();if(n.$3YZ!==-1&&n.$3Ye!==-1){t.$3YY=n.$3YZ;t.$3Yd=n.$3Ye}_js.Trace.logInfo(_a.$0.$4c,"ChatViewModelFactory: Chat.BodyText: {0}",n.get_$1Z6());var u=this;this.$B.$N3(IChatViewModelFactory,function(){return u},i,t,r,!1)},$br:function(n,t){return null},$wx:function(n,t){var i=n.get_$4c();return new _im.$HP(i,this.$B,this.$7F,this.$S3)}};_im.$1F7=function(n){this.$S3=n};_im.$1F7.prototype={$S3:null,$6hw:function(n,t,i){for(var u=new Array(n.get_$C()),f=new Array(n.get_$C()),r=0;r<n.get_$C();r++){var e=n.get_$3o(r);u[r]=e.get_$1o();f[r]=e.get_$Al()}var o=$5(t)?null:t.get_$Q();var s=this;_a.$42.$Gf(this.$S3.get_mainWindowInstance(),function(n){n.startChat(u,f,o,i)})}};_im.$12Y=function(n){_im.$12Y.initializeBase(this);this.$7a=n};_im.$12Y.prototype={$7a:null,$5gb:function(n){this.$7a.set_$12q(1);n.$59B(this.$7a.get_$Rd(),null,this.$$d_$AJb,this.$$d_$9e1)},$6Ti:function(n,t,i){if(n===-9){_js.Trace.logInfo(_a.$0.$4c,"AcceptChatAction.ProcessResult: Suppressing 'ConversationEnded' error.");n=0}if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}this.$7a.set_$12q(3);_js.Trace.logInfo(_a.$0.$4c,"AcceptChatSession web service call succeeded for chat {0}.",this.$7a.get_$Rd());t()},$TR:function(){_a.$2X.prototype.$TR.call(this)}};_im.$14B=function(n,t){this.$4dM=n;this.$5Rh=t};_im.$14B.prototype={$5Rh:null,$4dM:null,$2KJ:function(n,t){return this.$4dM.$2KJ(n,t)},$3oq:function(n,t){return this.$4dM.$3oq(n,t)},$7o1:function(n,t){return new _im.$1E7(n,t)},$5Kz:function(n){return this.$5Rh.$5Kz(n)}};_im.$162=function(n,t){_im.$162.initializeBase(this);this.$7a=n;this.$7u=t};_im.$162.prototype={$7a:null,$7u:null,$Z5:function(){_a.$2X.prototype.$Z5.call(this);this.$7u.$9nE(this.$7a)},$5gb:function(n){if(this.$7a.get_$Rd()===-1){this.$7a.set_$12q(4);return}n.$6jv(this.$7a.get_$Rd(),null,this.$$d_$AJb,this.$$d_$9e1)},$6Ti:function(n,t,i){this.$7a.set_$12q(4);if(!n){i(Error.create("EndChatAction returned false."));return}t()}};_im.$163=function(n){this.$7u=n};_im.$163.prototype={$7u:null,$5Kz:function(n){return new _im.$162(n,this.$7u)}};_im.$17p=function(n){_im.$17p.initializeBase(this);_a.$3.$1K3(n,"sipUris");this.$1W8=n};_im.$17p.prototype={$1W8:null,$5gb:function(n){n.$5Yz(this.$1W8,null,this.$$d_$AJb,this.$$d_$9e1)},$6Ti:function(n,t,i){if(n<0){i(Error.create("GetPresenceAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$19R=function(n){_im.$19R.initializeBase(this);this.$366=n};_im.$19R.prototype={$366:!1,$1n3:!1,$5gb:function(n){n.$5fm(this.$366,null,this.$$d_$AJb,this.$$d_$9e1)},$6Ti:function(n,t,i){if(n<0){if(n!==-2){_js.Trace.logInfo(_a.$0.$4c,"Sign in failed with code {0}, will retry.",n);this.$1n3=!0}i(Error.create("InstantMessageOperationError: "+n));return}t()}};_im.$19S=function(n){_im.$19S.initializeBase(this);this.$366=n};_im.$19S.prototype={$366:!1,$5gb:function(n){n.$5fn(this.$366,null,this.$$d_$AJb,this.$$d_$9e1)},$6Ti:function(n,t,i){if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}t()}};_im.$1DZ=function(){_im.$1DZ.initializeBase(this)};_im.$1DZ.prototype={$5gb:function(n){n.$2dk(null,this.$$d_$AJb,this.$$d_$9e1)},$6Ti:function(n,t,i){if(n<0){i(Error.create("ResetPresenceAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1E7=function(n,t){_im.$1E7.initializeBase(this);this.$7a=n;this.$2E=t};_im.$1E7.prototype={$2E:null,$7a:null,$Z5:function(){_a.$2X.prototype.$Z5.call(this)},$5gb:function(n){this.$7a.get_$12q()||this.$7a.set_$12q(1);var t=new _g.$b4(this.$2E);t.ChatSessionId=this.$7a.get_$Rd();t.Recipients=this.$7a.$86D();t.Subject=this.$7a.get_$2i();n.$4Zb(t,null,this.$$d_$AJb,this.$$d_$9e1)},$6Ti:function(n,t,i){if(n<0){i(Error.create("InstantMessageOperationError: "+n));return}this.$7a.set_$Rd(n);this.$7a.set_$12q(3);t()},$TR:function(){$5(this.$1d.message)&&this.$7a.$uz(_nbs.NonBootStrings.l_IMDeliveryError_Text);_a.$2X.prototype.$TR.call(this)}};_im.$1Ef=function(n,t){_im.$1Ef.initializeBase(this);_a.$3.$1G(n,"sipUri");this.$c1=n;this.$3ID=t};_im.$1Ef.prototype={$c1:null,$3ID:"None",$5gb:function(n){var t=new _g.$e6;t.Presence=this.$3ID;n.$4aa(t,null,this.$$d_$AJb,this.$$d_$9e1)},$6Ti:function(n,t,i){var r=n;if(r){i(Error.create("SetPresenceAction failed with InstantMessageOperationError: "+r));return}t()}};_im.$n5=function(n,t,i,r,u){_im.$n5.initializeBase(this);_a.$3.$K(i,"participants");_a.$3.$pj(i.get_$C(),0,"participants.Count");if(!$5(u)){if(i.get_$C()!==1)throw Error.invalidOperation("imAddress can only be used in conjunction with a single participant.");if(!$5(r))throw Error.invalidOperation("imAddress and itemOrConversation are mutually exclusive.");}this.$7u=n;this.$1Hp=$7GD(this,i);_a.$3.$pj(this.$1Hp.get_$C(),0,"No valid participants.");this.$2Cg=t;this.$48d=r;this.$1dd=u};function $7GD(n,t){for(var u=new _js.$c,f={},o=t.get_$C(),r=0;r<o;r++){var i=t.get_$3o(r);if(i&&n.$7u.$1Zb(i.get_$Al())){var e=i.get_$Al();if(!(e in f)){u.$D(i);f[e]=i}}}return u}_im.$n5.prototype={$7u:null,$2Cg:null,$1Hp:null,$48d:null,$1dd:null,$Z5:function(){_a.$2X.prototype.$Z5.call(this);if(!$5(this.$2Cg)){this.$2Cg.$6hw(this.$1Hp,this.$48d,this.$1dd);return}this.$7u.$6hw(this.$1Hp,this.$48d,this.$1dd)},$6JM:function(){return 0}};_im.$11f=function(n,t){this.$7u=n;this.$2Cg=t};_im.$11f.prototype={$7u:null,$2Cg:null,$2KJ:function(n,t){return new _im.$n5(this.$7u,this.$2Cg,n,t,null)},$3oq:function(n,t){var i=new _js.$c;i.$D(n);return new _im.$n5(this.$7u,this.$2Cg,i,null,t)}};_im.$1FG=function(n){_im.$1FG.initializeBase(this);_a.$3.$1K3(n,"sipUris");this.$1W8=n};_im.$1FG.prototype={$1W8:null,$5gb:function(n){n.$6ij(this.$1W8,null,this.$$d_$AJb,this.$$d_$9e1)},$6Ti:function(n,t,i){if(n<0){i(Error.create("SubscribeForPresenceUpdatesAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$1Gm=function(n){_im.$1Gm.initializeBase(this);_a.$3.$1G(n,"sipUri");this.$c1=n};_im.$1Gm.prototype={$c1:null,$5gb:function(n){n.$6mh(this.$c1,null,this.$$d_$AJb,this.$$d_$9e1)},$6Ti:function(n,t,i){if(n<0){i(Error.create("UnsubscribeFromPresenceUpdatesAction failed with InstantMessageOperationError: "+n));return}t()}};_im.$b2=function(n){this.$5Sw=n.get_$A8t();this.$Q0={}};function $4y9(n){var o=n.$1cj();var i=new(_0365f.$n.$$(String));var r=n.$Q0;for(var u in r){var f={key:u,value:r[u]};var s=f.value;var h=s.$1Al(n.$5Sw);h.$2U(o)<0&&i.$D(f.key)}for(var e=i.$6W(),c=e.length,t=0;t<c;++t){var l=e[t];delete n.$Q0[l]}}_im.$b2.prototype={$5Sw:0,$Q0:null,$D:function(n){$4y9(this);this.$Q0[n.toString()]=this.$1cj()},$NO:function(n){$4y9(this);return n.toString()in this.$Q0},$1cj:function(){return _a.$7.get_$2F()}};_im.$2b=function(n,t,i,r,u,f,e){this.$$d_$7X5=Function.createDelegate(this,this.$7X5);this.$$d_$9bs=Function.createDelegate(this,this.$9bs);this.$$d_$9bt=Function.createDelegate(this,this.$9bt);this.$$d_$9TR=Function.createDelegate(this,this.$9TR);this.$$d_$A2S=Function.createDelegate(this,this.$A2S);this.$$d_$43H=Function.createDelegate(this,this.$43H);this.$$d_$9Ot=Function.createDelegate(this,this.$9Ot);this.$$d_$9Ze=Function.createDelegate(this,this.$9Ze);this.$$d_$9Zf=Function.createDelegate(this,this.$9Zf);this.$$d_$9bQ=Function.createDelegate(this,this.$9bQ);this.$$d_$9bR=Function.createDelegate(this,this.$9bR);this.$$d_$9bv=Function.createDelegate(this,this.$9bv);this.$$d_$9bw=Function.createDelegate(this,this.$9bw);this.$$d_$9L4=Function.createDelegate(this,this.$9L4);this.$$d_$4OW=Function.createDelegate(this,this.$4OW);this.$$d_$A5D=Function.createDelegate(this,this.$A5D);this.$vz=new _js.$c;this.$Bf=new _js.$c;this.$mI=new _js.$c;_im.$2b.resolveInheritance();this.apcl=this.$Y;this.rpcl=this.$q;_im.$2b.initializeBase(this);this.$lr("Initialization","unknown");this.$h9=t;this.add_$3Mh(this.$h9.$$d_$ADA);if(!n){this.$lr("Initialization","Disabled");return}this.$k=i;this.$1V1=!0;this.$29E=!1;this.$41v=new _im.$b2(_a.$Ms.$80L(30));var o=new _g.$Ac;o.NotificationType="InstantMessageNotification";this.$X9=new _h.$B8(o,this.$k,r);this.$X9.add_$4dt(this.$$d_$A5D);if(u&&e){this.$5hX=!0;_js.Trace.logInfo(_a.$0.$4c,"ChatManager: Waiting for the pending-get activation event.");var s=this;u.$Hd(_a.$Yw,function(n){_js.Trace.logInfo(_a.$0.$4c,"ChatManager: Pending-get activated.");s.$28W=!0;$4yL(s)});var h=this;u.$Hd(_a.$sH,function(){$4yA(h)});u.$Hd(_a.$TR,this.$$d_$4OW);f?$7G6(this,f):this.$ZW="Disabled"}this.$vz.add_$1Y(this.$$d_$9L4);this.$2cO=this.$7nT(this.$k)};_im.$2b.$6lq=function(n,t,i){var r;var u,f;if(f=n.$2il(function(n){return n.get_$Rd()===t},u={val:r}),r=u.val,f){i.val=r;return!0}i.val=null;return!1};_im.$2b.$A9s=function(n,t,i){var r;var u,f;var e=(f=n.$2il(function(n){var i=n;if(i.get_$Qc().get_$C()!==1)return!1;var r=i.get_$Qc().get_$3o(0);return r.get_$Al()===t?!0:!1},u={val:r}),r=u.val,f);i.val=r;return e};function $7G7(n,t,i,r){if(n.$ZW!=="Disabled"){var u=t?"SignedOut":"Disabled";if(_js.$8.$a(r)){_js.Trace.logInfo(_a.$0.$4c,"The currentUserSipUri is null/empty -> Marking SignInState as disabled.");u="Disabled"}else r=_im.$8A.$nB(r);n.$lr("Configuration Updated",u)}n.$5N5=i;n.$6nA("InternalSetConfiguration",r);n.$3nO=!0}function $4yI(n,t){var i=new _g.$Y9;_a.$3.$m(t,"persona");i.DisplayName=t.get_$1o();i.SipUri=t.get_$Al();return i}function $4yE(n,t,i){_js.Trace.logInfo(_a.$0.$4c,"Creating new Chat.");var r=new _h.$1e(!0);r.get_$Qc().add_$1Y(n.$$d_$9Ot);r.get_$Qc().$3o8(t);r.set_$1y(new _g.$1t("IM:"+Math.random().toString()));if(!i)return r;if(_g.$y.isInstanceOfType(i)){r.set_$5qP(i);return r}if(_g.$7f.isInstanceOfType(i)){r.set_$5qN(i);return r}var u=_js.$8.$4B("CreateChat: itemOrConversation type {0} is not supported.",Object.getType(i).getName());_js.Trace.logError(_a.$0.$4c,u);throw Error.invalidOperation(u);}function $4yB(n,t){_js.Trace.logInfo(_a.$0.$4c,"Activating chat.");$5(t.get_$1y())||_h.$1L.get_$I().$IB(t.get_$1y().Id,t);var i=$7G4(n,t);n.$vz.$6r(i,t)}function $7G9(n,t,i,r){var f=t.PayloadType;switch(f){case"NewChatMessageToast":_js.Trace.logInfo(_a.$0.$4c,"NewChatMessageToast received and mapped to chat {0}.",i.get_$Rd());return;case"ParticipantJoined":n.$h9.$5AG(t);var u;if($5(t.Persona))u=_pc.$l.$3pF(r,t.SipUri);else{u=new _pc.$l;u.$Qq(t.Persona)}i.$9fn(t.SipUri,u,r);return;case"ParticipantLeft":i.$9fo(t.SipUri,r);return;case"EndChatSession":i.$5cL||n.$Bf.$34(i);return;case"NewChatMessage":i.$6LY(r,t.MessageContent);return;case"UserActivity":switch(t.UserActivity){case"FailedDelivery":i.$uz(_nbs.NonBootStrings.l_IMDeliveryError_Text);return;case"Typing":i.$A24(r);return;case"StoppedTyping":i.set_$Az("");return;case"TwoOrMoreTyping":i.set_$Az(_nbs.NonBootStrings.l_IMActivityMultipleUsersTyping_Text);return;case"DeliveryTimeout":i.$uz(_nbs.NonBootStrings.l_IMDeliveryTimeout_Text);return;default:return}}}function $7GB(n,t){if(t.PayloadType==="NewChatMessageToast"){n.$h9.$5AG(t);var r=n.$h9.$30P(t.SipUri,t.DisplayName);var f=$4yF(n,t.Persona,r,t.SipUri,t.ToastMessage,t.MessageSubject,t.ChatSessionId);_js.Trace.logInfo(_a.$0.$4c,"ChatManager.TryProcessInvitation: Created invitation for conversation {0} (NewChatMessageToast).",t.ChatSessionId);return!0}if(t.PayloadType==="NewChatMessage"){var i=n.$h9.$30P(t.SipUri,t.DisplayName);var u=$4yF(n,t.Persona,i,t.SipUri,t.MessageContent,"",t.ChatSessionId);u.$6LY(i,t.MessageContent);_js.Trace.logInfo(_a.$0.$4c,"ChatManager.TryProcessInvitation: Created invitation for conversation {0} (NewChatMessage).",t.ChatSessionId);return!0}return!1}function $4yF(n,t,i,r,u,f,e){var s;if($5(t))s=_pc.$l.$3pF(i,r);else{s=new _pc.$l;s.$Qq(t)}$5(u)&&(u="");var h=new _js.$c;h.$D(s);var o=$4yE(n,h,null);o.set_$Rd(e);o.$3Ve=s;o.$4gJ=u;_js.$8.$15(f)||o.set_$2i(f);n.$Bf.$D(o);return o}function $7G0(n,t){_a.$3.$m(t,"senderInfo");for(var f=t,e=f.length,i=0;i<e;++i){var r=f[i];var u=r.SipUri;_js.Trace.logInfo(_a.$0.$qR,"Adding pending contact to buddy requests list",u);var o=$7G5(n,r.DisplayName,r.Title,u);$4yJ(n,u,!1)||n.$mI.$D(o)}}function $7GA(n,t){_a.$3.$m(t,"senderInfo");for(var r=!1,u=t,e=u.length,i=0;i<e;++i){var o=u[i];var f=o.SipUri;_js.Trace.logInfo(_a.$0.$qR,"Examining the AddToBuddyList payload for existing buddy requests",f);r=$4yJ(n,f,!0)}return r}function $7G1(n){_js.Trace.logInfo(_a.$0.$qR,"Received empty subscribers notification, we need to hide the pending buddy dialogue");n.$mI.$1t()}function $7G5(n,t,i,r){_a.$3.$m(t,"displayName");_a.$3.$m(r,"buddyImAddress");var u=_pc.$l.$3pF(t,r);_js.$8.$a(i)||u.set_$4o(i);return u}function $4yJ(n,t,i){for(var r=0;r<n.$mI.get_$C();r++){var u=n.$mI.get_$3o(r);if(!u.get_$Al().localeCompare(t)){if(i){_js.Trace.logInfo(_a.$0.$qR,"Removing already added contact from pending buddyRequests",u.get_$Al());n.$mI.$6C(r)}return!0}}return!1}function $7G4(n,t){var i=this;return n.$vz.$Dn(function(n){return t.$2U8.$2U(n.$2U8)>=0})}function $1qP(n,t){n.$1nP&&(n.$1nP=_js.$J.get_$I().$5A(n.$1nP));var i=n.$3RG;n.$3RG=t;if(t&&i){_js.Trace.logInfo(_a.$0.$4c,"Service confirmed available.");return}else if(t&&!i){_js.Trace.logInfo(_a.$0.$4c,"Service resumed.");return}else if(!t&&i){_js.Trace.logInfo(_a.$0.$4c,"Service interrupted.");$4yA(n);$4yK(n);return}else if(!t&&!i){_js.Trace.logInfo(_a.$0.$4c,"Service confirmed unavailable.");$4yK(n);return}_js.Trace.logError(_a.$0.$4c,"Unexpected condition in ChatManager.SetServiceAvailability.")}function $7G8(n){n.$lr("SignedOn Succeeded","SignedIn");n.$1V1=!0;n.$29E=!1}function $4yA(n){n.$vz.$Bd(n.$$d_$7X5);n.$Bf.$Bd(n.$$d_$7X5);var t=this;n.$vz.$Bd(function(t){t.$A1r(n.$3RG)})}function $4yK(n){if(n.$ZW==="AttemptingSignIn"||n.$ZW==="SignedIn"||n.$ZW==="Error"){if(n.$1V1){n.$1V1=!1;n.$7qS();return}n.$29E=!1;n.$lr("SignIn-GiveUp","Error")}}function $7G3(n,t,i,r,u){var e=n.$h9.$30P(i,null);var o=new _im.$sx(t,i,e,r,u);var f=n.$jB(_im.$2b.$2cN);f&&f(o)}function $7G2(n,t){var i=n.$jB(_im.$2b.$2cN);if(i){var e=t.PayloadType;if(t.PayloadType==="UpdateUserPresence"){var r=t.DisplayName;_js.$8.$15(r)&&(r=n.$5N5);var s=new _im.$sx(e,n.$2Kr,r,_im.$8A.$1xZ(t.NewUserPresence),!0);i(s);return}if(!$5(t.UserPresenceChanges))for(var h=t.PayloadType!=="QueryUserPresenceChange",o=t.UserPresenceChanges,c=o.length,u=0;u<c;++u){var f=o[u];var l=new _im.$sx(e,f.SipUri,f.UserName,_im.$8A.$1xZ(f.Presence),h);i(l)}}}function $4yH(n,t){var r=new(_0365f.$n.$$(String));if(t)for(var u=t,f=u.length,i=0;i<f;++i){var e=u[i];$4yC(n,r,e)}return r}function $4yG(n,t){for(var e=$3d6(n,n.$vz.$6W()),r=new(_0365f.$n.$$(String)),u=t.get_$3O(),o=u.length,i=0;i<o;++i){var f=u[i];e.$76(f)||r.$D(f)}return r}function $3d6(n,t){var r=new(_0365f.$n.$$(String));if(t)for(var u=t,e=u.length,i=0;i<e;++i){var o=u[i];var f=o;if(f.get_$Qc()){var s=this;f.get_$Qc().$Bd(function(t){$4yC(n,r,t)})}}return r}function $4yC(n,t,i){var u=i;var r=_im.$8A.$nB(u.get_$Al());r.localeCompare(n.$2Kr)&&(t.$76(r)||t.$D(r))}function $4yD(n,t){n.$5hX&&(n.$ZW==="unknown"||!n.$3nO)&&_js.Trace.logError(_a.$0.$4c,"ChatManager: Do not access {0} until configuration has loaded.",t)}function $4yL(n){if(n.get_$2a()&&n.$28W&&n.$3nO){var t=this;_js.$J.get_$I().$1s(_a.$0.$4c,"ChatManager.SignIn",function(){n.$4cb(!1)},5e3)}}function $7G6(n,t){var i=t.get_$5z().get_$33r();var r=t.get_$2z().get_$Fn();var u=t.get_$2z().get_$1KU();$7G7(n,i,r,u);$4yL(n)}_im.$2b.prototype={$h9:null,$5hX:!1,$5N5:null,$2Kr:null,$28W:!1,$3nO:!1,$5ho:!1,$41v:null,$k:null,$3RG:!1,$1V1:!1,$4dw:!1,$ZW:"unknown",$1nP:null,$29E:!1,$X9:null,$2cO:null,add_$3Mh:function(n){this.$2G(_im.$2b.$2cN,n)},remove_$3Mh:function(n){this.$2H(_im.$2b.$2cN,n)},get_$2gm:function(){return this.$ZW},get_$yh:function(){return this.$ZW==="SignedIn"},get_$2a:function(){$4yD(this,"IsEnabled");return this.$ZW!=="Disabled"},get_$7XW:function(){return this.$vz},get_$43P:function(){return this.$Bf},get_$5EY:function(){return this.$mI},get_$8Je:function(){return this.$5ho},get_$1uO:function(){$4yD(this,"CurrentUserSipUri");return this.$2Kr},set_$1uO:function(n){this.$2Kr=n;return n},$4cb:function(n){if(!this.$28W){_js.Trace.logInfo(_a.$0.$4c,"Ignoring a SignIn attempt because the pending-get connection is not yet started.");return}this.$1V1=!0;this.$29E=n;this.$43H()},$6gq:function(n){_js.Trace.logInfo(_a.$0.$4c,"Signing out.");var t=new _im.$19S(n);t.add_$29(this.$$d_$9bw);t.add_$21(this.$$d_$9bv);this.$lr("SignOut:Manual="+n,"AttemptingSignOut");this.$k.$11(t)},$4iR:function(n,t,i){var r=_im.$8A.$nB(t);var u;var f,e;var o=(e=this.$h9.$6lr(r,f={val:u}),u=f.val,e);$7G3(this,n,r,_im.$8A.$1xZ(i),o)},$A4v:function(n,t){var i=new _im.$1Ef(_im.$8A.$nB(n),t);i.add_$29(this.$$d_$9bR);i.add_$21(this.$$d_$9bQ);this.$k.$11(i)},$lr:function(n,t){t==="Error";_js.Trace.logInfo(_a.$0.$4c,"SignInState: {0} Requesting change from {1} to {2}",n,this.$ZW,t);var i=this.get_$yh();if(this.$ZW!==t){this.$ZW=t;$N(this,_im.$2b.$3Te);this.get_$yh()!==i&&$N(this,_im.$2b.$5lq)}},$6nA:function(n,t){_js.Trace.logInfo(_a.$0.$4c,"Setting current user SIP URI to {0}",t);this.$2Kr=t},$2dk:function(){if(this.$ZW==="SignedIn"){_js.Trace.logInfo(_a.$0.$4c,"ResetPresence");var n=new _im.$1DZ;n.add_$29(this.$$d_$9Zf);n.add_$21(this.$$d_$9Ze);this.$k.$11(n)}},$6hw:function(n,t,i){_js.Trace.logInfo(_a.$0.$4c,"Starting chat.");_a.$3.$m(n,"basePersonaParticipants");_a.$3.$pj(n.get_$C(),0,"basePersonaParticipants.Count");$5(i)||_a.$3.$KI(n.get_$C(),1,"When imAddress is specified, participant count must be 1.");for(var u=new _js.$c,l=n.get_$C(),o=0;o<l;o++){var a=n.get_$3o(o);var v=_pc.$l.$1ND(a);u.$D(v)}var r=null;if(u.get_$C()===1){var e=u.get_$3o(0);var f=null;$5(i)?$5(e.get_$Al())||(f=e.get_$Al()):f=i;if(!$5(f)){var s,h;h=_im.$2b.$A9s(this.$vz,f,s={val:r});r=s.val;h}var c=e.get_$1o();if(!_js.$8.$15(f)&&!_js.$8.$15(c)){var y=_im.$8A.$nB(f);this.$h9.$6Q("StartChat (single participant)",y,c,e.$N4,!0)}}else{var p=this;u.$Bd(function(n){var t=n;var i=t.get_$Al();var r=t.get_$1o();if(!_js.$8.$15(i)&&!_js.$8.$15(r)){var u=_im.$8A.$nB(i);p.$h9.$6Q("StartChat (multiple participants)",u,r,t.$N4,!0)}})}if(!r){r=$4yE(this,u,t);$4yB(this,r);if(!$5(i)){var w=u.get_$3o(0);r.$9vG(w,i)}}_g.$y.isInstanceOfType(t)?r.set_$5qP(t):_g.$7f.isInstanceOfType(t)&&r.set_$5qN(t);return r},$3gS:function(n){_js.Trace.logInfo(_a.$0.$4c,"Accepting invitation.");this.$Bf.$34(n);$4yB(this,n);var t=new _im.$12Y(n);this.$k.$11(t)},$41t:function(n){_js.Trace.logInfo(_a.$0.$4c,"Ignoring invitation.");this.$Bf.$34(n);this.$41v.$D(n.get_$Rd())},$7X8:function(n){_js.Trace.logInfo(_a.$0.$qR,"Accepting buddy request {0} ",n.get_$1l());var i=$4yI(this,n);var t=new _g.$YA;t.GroupType="OtherContacts";var r=new _c.$12X(i,t);this.$k.$11(r)},$7px:function(n){_js.Trace.logInfo(_a.$0.$qR,"Ignoring buddy request {0} ",n.get_$1l());this.$mI.$34(n);var t=$4yI(this,n);var i=new _c.$15I(t);this.$k.$11(i)},$9nE:function(n){_js.Trace.logInfo(_a.$0.$4c,"Removing chat {0}",n.get_$Rd());n.set_$12q(4);n.get_$Qc().remove_$1Y(this.$$d_$9Ot);var t=this.$vz.$34(n);var i=this.$Bf.$34(n);$5(n.get_$1y())||_h.$1L.get_$I().$bo(n.get_$1y().Id)},$9TR:function(n){if(n.EventType==="Reload"){_js.Trace.logWarning(_a.$0.$4c,"ChatManager.OnIMNotification: Received a 'Reload' notification from the OWA server, assuming server has rebooted or connection re-established");this.$1V1=!0;$1qP(this,!1);return}var t=n;var i=t.PayloadType;if($5(i)){_js.Trace.logWarning(_a.$0.$4c,"ChatManager.OnIMNotification: Unexpected notification payload: {0}, {1}",n.EventType,n.toString());return}if(i==="ServiceUnavailable"){if(t.ServiceError==="ClientSignOut"){_js.Trace.logWarning(_a.$0.$4c,"ChatManager.OnIMNotification: Service unavailable, client signed out.  {0}",t.ErrorMessage);this.$lr("IMNotification","SignedOut");return}_js.Trace.logWarning(_a.$0.$4c,"ChatManager.OnIMNotification: Received a 'ServiceUnavailable' notification: {0}, {1}.",t.ServiceError,t.ErrorMessage);$1qP(this,!1);return}if(i==="SignOn")if(t.SignOnStarted){_js.Trace.logInfo(_a.$0.$4c,"ChatManager.OnIMNotification: Sign-on started.");return}else{_js.Trace.logInfo(_a.$0.$4c,"ChatManager.OnIMNotification: Sign-on succeeded.");$1qP(this,!0);$7G8(this);this.$5ho=t.IsUserInUcsMode;return}if(i==="UpdateUserPresence"||i==="UserPresenceChange"||i==="QueryUserPresenceChange"){$7G2(this,t);return}this.$h9.$6my(t);!$5(t.Persona)&&$5(t.Persona.ImAddress)&&(t.Persona.ImAddress=t.SipUri);if(t.PayloadType==="PendingContactList"){if($5(t.PendingContacts)){_js.Trace.logWarning(_a.$0.$qR,"The payload for PendingContacts is empty");return}$7G0(this,t.PendingContacts);return}if(t.PayloadType==="AddToBuddyList"){if($5(t.AddedContacts)){_js.Trace.logWarning(_a.$0.$qR,"The payload for AddedContacts is empty");return}$7GA(this,t.AddedContacts)&&_js.Trace.logInfo(_a.$0.$qR,"Removed already added contact from pending buddyRequests");return}if(t.PayloadType==="EmptySubscribers"){$7G1(this);_js.Trace.logInfo(_a.$0.$qR,"Removed already added contact from pending buddyRequests after receiving emptysubscribers");return}if(!("ChatSessionId"in t)){_js.Trace.logInfo(_a.$0.$4c,"Notification {0} not supported, no session id.",i);return}if(this.$41v.$NO(t.ChatSessionId)){_js.Trace.logInfo(_a.$0.$4c,"ChatManager.OnIMNotification: {0} for conversation {1} was ignored.",t.PayloadType,t.ChatSessionId);return}_js.Trace.logInfo(_a.$0.$4c,"ChatManager.OnIMNotification: {0}, Session={1}, SipUri={2}",i,t.ChatSessionId,t.SipUri);var r;var u,f,e,o;if((f=_im.$2b.$6lq(this.$vz,t.ChatSessionId,u={val:r}),r=u.val,f)||(o=_im.$2b.$6lq(this.$Bf,t.ChatSessionId,e={val:r}),r=e.val,o)){var s=this.$h9.$30P(t.SipUri,t.DisplayName);$7G9(this,t,r,s);return}_js.Trace.logInfo(_a.$0.$4c,"No matching chat found for session {0}",t.ChatSessionId);$7GB(this,t)},$2s4:function(n){for(var r=n.get_$C(),t=0;t<r;t++){var i=n.get_$3o(t);if(i&&this.$1Zb(i.SipUri))return!0}return!1},$1Zb:function(n){return _js.$8.$15(n)?!1:_js.$8.$15(this.get_$1uO())?!1:n.toLowerCase()===this.get_$1uO().toLowerCase()?!1:!0},$1xZ:function(n){return _im.$8A.$1xZ(n)},$5aF:function(n){return _im.$8A.$5aF(n)},$7nT:function(n){return new _im.$fx(n)},$7qS:function(){this.$lr("DelayInternalSignIn","AttemptingSignIn");_js.$J.get_$I().$1s(_a.$0.$4c,"ChatManager.InternalSignIn",this.$$d_$43H,3e4)},$49:function(){this.remove_$3Mh(this.$h9.$$d_$ADA);_js.$9.prototype.$49.call(this)},$9bt:function(n){_js.Trace.logInfo(_a.$0.$4c,"Sign-in action succeeded.  Awaiting notification.");this.$1nP=_js.$J.get_$I().$1s(_a.$0.$4c,"ChatManager.SignInNotificationTimeout",this.$$d_$A2S,1e4)},$9bs:function(n){_js.Trace.logInfo(_a.$0.$4c,"Sign-in action failed.");var t=n;if(t.get_$hJ()===-11){_js.Trace.logInfo(_a.$0.$4c,"Automatic sign-in rejected because the user was explicitly signed out.");this.$lr("Automatic Sign-In Rejected","SignedOut");return}_js.Trace.logWarning(_a.$0.$4c,"Sign-in failed: {0}",t.$1d.message);$1qP(this,!1)},$A2S:function(){_js.Trace.logWarning(_a.$0.$4c,"Sign-in timeout expired.  Current sign-in state: {0}, ServiceAvailable: {1}.",this.$ZW,this.$3RG);this.$ZW!=="SignedIn"&&$1qP(this,!1)},$9bw:function(n){_js.Trace.logInfo(_a.$0.$4c,"Sign-out succeeded.");this.$lr("SignOutSucceeded","SignedOut")},$A5D:function(n,t){if(!this.$4dw){_js.Trace.logInfo(_a.$0.$4c,"Subscribed to notifications.");this.$4dw=!0;this.$43H()}},$43H:function(){if(!this.$4dw){_js.Trace.logInfo(_a.$0.$4c,"Subscribing to notifications.");this.$X9.$Hd(_a.$0.$4c,"OnIMNotification",this.$$d_$9TR,1);return}_js.Trace.logInfo(_a.$0.$4c,"Signing in. Manual: {0}, will retry: {1}",this.$29E,this.$1V1);var n=new _im.$19R(this.$29E);n.add_$29(this.$$d_$9bt);n.add_$21(this.$$d_$9bs);this.$lr("InternalSignIn","AttemptingSignIn");this.$k.$11(n);this.$1nP&&(this.$1nP=_js.$J.get_$I().$5A(this.$1nP))},$9bv:function(n){_js.Trace.logWarning(_a.$0.$4c,"Sign-out failed: {0}",n.$1d.message);this.$lr("SignOutFailed","SignedOut")},$9Zf:function(n){_js.Trace.logInfo(_a.$0.$4c,"Reset presence succeeded.")},$9Ze:function(n){_js.Trace.logWarning(_a.$0.$4c,"Reset presence failed: {1}",n.$1d.message)},$9bR:function(n){var t=n;_js.Trace.logInfo(_a.$0.$4c,"Set presence to {0} succeeded.",t.$3ID)},$9bQ:function(n){var t=n;_js.Trace.logWarning(_a.$0.$4c,"Set presence to {0} failed: {1}",t.$3ID,n.$1d.message)},$7X5:function(n){var t=n;t.set_$Rd(-2);t.$A1s()},$9Ot:function(n,t){switch(t.$2Z){case 0:var i=t.$2q;var r=$4yH(this,i);this.$2cO.$5Aj(r);break;case 2:var u=t.$3B;var f=$4yH(this,u);var e=$4yG(this,f);this.$2cO.$29x(e);break;case 1:case 3:default:_a.$3.$9t(!1,"Unexpected notification received: "+t.$2Z);break}},$9L4:function(n,t){switch(t.$2Z){case 0:var i=t.$2q;var r=$3d6(this,i);this.$2cO.$5Aj(r);break;case 2:var u=t.$3B;var f=$3d6(this,u);var e=$4yG(this,f);this.$2cO.$29x(e);break;case 1:case 3:default:_a.$3.$9t(!1,"Unexpected notification received: "+t.$2Z);break}},$4OW:function(n){if(!n.$5JB){this.$1V1=!1;$1qP(this,!1)}}};_im.$14C=function(n,t,i,r,u,f,e){this.$2v=n;this.$h9=t;this.$k=i;this.$1nf=r;this.$J=u;this.$b=f;this.$1eo=e};_im.$14C.prototype={$2v:!1,$h9:null,$k:null,$1nf:null,$J:null,$b:null,$1eo:!1,$7u:null,$E:function(){this.$7u||(this.$7u=new _im.$2b(this.$2v,this.$h9,this.$k,this.$1nf,this.$J,this.$b,this.$1eo));return this.$7u}};_im.$EG=function(){this.$$d_$ADA=Function.createDelegate(this,this.$ADA);_im.$EG.initializeBase(this);this.$H5={}};function $4yN(n,t,i){if(!_js.$8.$15(t.SipUri)){$4yM(n,t.PayloadType,t.SipUri,t.DisplayName,i);if(!$5(t.NewUserPresence)){var r=_im.$8A.$1xZ(t.NewUserPresence);$4yP(n,t.PayloadType,t.SipUri,r,i)}}}function $4yM(n,t,i,r,u){var f=this;$4yO(n,t,i,u,function(n){_js.$8.$15(r)||n.set_$1o(r)})}function $4yP(n,t,i,r,u){var f=this;$4yO(n,t,i,u,function(n){$5(r)||n.set_$Fa(r)})}function $4yO(n,t,i,r,u){i=_im.$8A.$nB(i);var f=n.$H5[i];if($5(f)){if(!r)return;f=new _im.$14D(i);n.$H5[i]=f}u(f)}_im.$EG.prototype={$H5:null,$2dk:function(){var n=this.$H5;for(var t in n){var i={key:t,value:n[t]};var r=i.value;r.set_$Fa(0)}},$6my:function(n){$4yN(this,n,!1)},$5AG:function(n){$4yN(this,n,!0)},$ADA:function(n){this.$6Q(n.$2C,n.$c1,n.$7K,n.$N4,n.$43V)},$6Q:function(n,t,i,r,u){$4yM(this,n,t,i,u);$4yP(this,n,t,r,u)},$30P:function(n,t){var i=t;if(_js.$8.$15(i)&&!_js.$8.$15(n)){n=_im.$8A.$nB(n);var r=this.$H5[n];$5(r)||(i=r.$7K);_js.$8.$15(i)&&(i=_im.$8A.$fu(n))}return i},$6lr:function(n,t){t.val=0;n=_im.$8A.$nB(n);var i=this.$H5[n];if($5(i))return!1;t.val=i.$N4;return!0}};_im.$14D=function(n){_im.$14D.initializeBase(this);_a.$3.$1G(n,"sipUri");this.$c1=n};_im.$14D.prototype={$c1:null,$7K:null,$N4:0,get_$1o:function(){return this.$7K},set_$1o:function(n){if(this.$7K===n)return n;this.$7K=n;$N(this,"DisplayName");return n},get_$Fa:function(){return this.$N4},set_$Fa:function(n){if(this.$N4===n)return n;this.$N4=n;$N(this,"Presence");return n},toString:function(){return String.format("SipUri: {0}, DisplayName: {1}, Presence: {2}",this.$c1,$5(this.$7K)?"":this.$7K,this.$N4)}};_im.$14E=function(n,t,i,r){this.$$d_$9Uv=Function.createDelegate(this,this.$9Uv);this.$15T=n;this.$7u=t;this.$294=i;this.$1tL=r;this.$294.add_$AGT(this.$$d_$9Uv);this.$1tL.add_$AGT(this.$$d_$9Uv)};_im.$14E.prototype={$7u:null,$294:null,$1tL:null,$15T:!1,$4C:null,$45b:!1,$5pD:0,add_$gz:function(n){if(n&&this.$15T){if(this.get_$D2()){n();return}this.$4C||(this.$4C=new Sys.EventHandlerList);this.$4C.addHandler("chatInitialized",n)}},remove_$gz:function(n){this.$4C&&this.$4C.removeHandler("chatInitialized",n)},get_$CK:function(){return this.get_$D2()&&this.$15T?this.$7u:null},get_$1I6:function(){return this.get_$D2()&&this.$15T?this.$294.get_$1n():null},get_$wZ:function(){return this.get_$D2()&&this.$15T?this.$1tL.get_$1n():null},get_$gC:function(){return this.$15T},get_$D2:function(){if(!this.$45b&&this.$15T){this.$294.$E(null);this.$1tL.$E(null)}return this.$45b||!this.$15T},$9Uv:function(){this.$5pD++;if(this.$5pD===2){this.$45b=!0;if(this.$4C){this.$4C.getHandler("chatInitialized")();this.$4C=null}}}};_im.$14F=function(n,t,i,r){this.$15T=n;this.$7u=t;this.$294=i;this.$1tL=r};_im.$14F.prototype={$15T:!1,$7u:null,$294:null,$1tL:null,$w:null,$E:function(){this.$w||(this.$w=new _im.$14E(this.$15T,this.$7u,this.$294,this.$1tL));return this.$w}};_im.$10T=function(n,t,i){_im.$10T.initializeBase(this,[n,t,i]);_js.Trace.logInfo(_a.$0.$4c,"PopOutPresenceManager.Ctor.")};_im.$10T.prototype={$7nS:function(){return new _im.$1Co(this.$1I5)},$6MM:function(n){$3d8(this,n.$c1,n.$N4)},$4iP:function(n){this.$1lg.$5AH(n)},$ADE:function(){}};_im.$1Co=function(n){_im.$1Co.initializeBase(this,[n]);_js.Trace.logInfo(_a.$0.$4c,"PopOutPresenceRequestsManager.Ctor")};_im.$1Co.prototype={$5AH:function(n){_a.$3.$1G(n,"sipUri");this.$1I5.$9l5(n)},$9o0:function(n){_a.$3.$1G(n,"sipUri");return!0},$7gr:function(){}};_im.$Ht=function(n,t,i){this.$$d_$9TK=Function.createDelegate(this,this.$9TK);this.$$d_$6MM=Function.createDelegate(this,this.$6MM);this.$$d_$9bu=Function.createDelegate(this,this.$9bu);this.$i9={};_im.$Ht.initializeBase(this);_a.$3.$K(n,"chatManager");_a.$3.$K(t,"chatParticipantCache");_a.$3.$K(i,"presenceCrossWindowNotifier");this.$7u=n;this.$H5=t;this.$7u.$Y(_im.$2b.$3Te,this.$$d_$9bu);this.$7u.add_$3Mh(this.$$d_$6MM);this.$1I5=i;this.$1lg=this.$7nS();this.$228=this.$7u.$ZW;_js.Trace.logInfo(_a.$0.$Fa,"PresenceManager.Ctor.")};function $3d8(n,t,i){t=_im.$8A.$nB(t);if(!(t in n.$i9))return!1;for(var u=n.$i9[t],r=0;r<u.get_$C();r++){var f=u.get_$3o(r);f.set_$Fa(i)}return!0}function $4yQ(n,t,i){if(!n.$7u.get_$2a())return!1;t.rpcl("ImAddress",n.$$d_$9TK);if(_js.$8.$15(i))return!1;var r=_im.$8A.$nB(i);if(!(r in n.$i9))return!1;var u=n.$i9[r];var f=u.$34(t);if(!u.get_$C()){delete n.$i9[r];n.$1lg.$9o0(r)}return f}function $7GC(n,t,i){t in n.$i9||(n.$i9[t]=new(_a.$Z.$$(_h.$rD)));var r=n.$i9[t];if(!r.$76(i)){r.$D(i);r.get_$C()>1?i.set_$Fa(r.get_$3o(0).get_$Fa()):n.get_$yh()||i.set_$Fa(0)}}_im.$Ht.prototype={$7u:null,$H5:null,$1I5:null,$1lg:null,$228:"unknown",get_$yh:function(){return this.$7u.$ZW==="SignedIn"},$6lv:function(n){_a.$3.$K(n,"persona");if(!this.$7u.get_$2a())return!1;_js.Trace.logInfo(_a.$0.$Fa,"PresenceManager.TryRegisterForPresenceUpdates: Registering persona for presence updates: {0}, SIP:{1}",n.get_$6P(),n.get_$Al()||"");n.apcl("ImAddress",this.$$d_$9TK);if(_js.$8.$15(n.get_$Al()))return!0;var t=_im.$8A.$nB(n.get_$Al());$7GC(this,t,n);this.$4iP(t);return!0},$4hP:function(n){_a.$3.$K(n,"persona");_js.Trace.logInfo(_a.$0.$Fa,"PresenceManager.TryUnregisterForPresenceUpdates: Unregistering persona for presence updates: {0}, SIP:{1}",n.get_$6P(),n.get_$Al()||"");return $4yQ(this,n,n.get_$Al())},$9l4:function(n,t){_a.$3.$1G(n,"sipUri");this.$4iP(n);t.val=0;if(n in this.$i9){var i=this.$i9[n];if(i.get_$C()>0){t.val=i.get_$3o(0).get_$Fa();return!0}}return!1},$7nS:function(){return new _im.$Mx(this.$1I5)},$4iP:function(n){if(this.get_$yh()){var t;var i,r;(r=this.$H5.$6lr(n,i={val:t}),t=i.val,r)&&$3d8(this,n,t);n!==_im.$8A.$nB(this.$7u.get_$1uO())&&this.$1lg.$5AH(n)}},$6MM:function(n){if(this.get_$yh()){$3d8(this,n.$c1,n.$N4);this.$1I5.$6nb(n.$c1,n.$N4)}},$ADE:function(){this.$1I5.$ADr(this.$228)},$49:function(){_js.Trace.logInfo(_a.$0.$Fa,"PresenceManager.InternalDispose.");this.$7u.$q(_im.$2b.$3Te,this.$$d_$9bu);this.$7u.remove_$3Mh(this.$$d_$6MM);this.$1lg.$1R();this.$1lg=null},$9bu:function(n,t){var c=n;var i=this.$228;var l=i==="SignedIn";this.$228=c.$ZW;var u=this.get_$yh();if(l!==u)if(u){_js.Trace.logInfo(_a.$0.$Fa,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Requesting presence for every persona active.",i,this.$228);var s=this.$i9;for(var h in s){var v={key:h,value:s[h]};var y=v.key;this.$4iP(y)}}else{_js.Trace.logInfo(_a.$0.$Fa,"PresenceManager.OnSignInStateChanged: OldSignInState: {0} to NewSignInState: {1}. Resetting presence to Unknown everywhere.",i,this.$228);var f=this.$i9;for(var e in f)for(var a={key:e,value:f[e]},o=a.value,r=0;r<o.get_$C();r++)o.get_$3o(r).set_$Fa(0);this.$1lg.$7gr();this.$H5.$2dk()}this.$ADE()},$9TK:function(n,t){var i=n;var r=null;var u=this.$i9;for(var f in u){var e={key:f,value:u[f]};var o=e.key;var s=e.value;if(s.$76(i)){r=o;break}}_js.Trace.logInfo(_a.$0.$Fa,"PresenceManager.OnImAddressChangedForAPersona: Unregistering persona {0} for old IM Address {1}",i.get_$6P(),r);$4yQ(this,i,r);_js.Trace.logInfo(_a.$0.$Fa,"PresenceManager.OnImAddressChangedForAPersona: Re-registering persona {0} for new IM Address {1}",i.get_$6P(),$5(i.get_$Al())?"":i.get_$Al());this.$6lv(i)}};_im.$Mx=function(n){this.$$d_$9d6=Function.createDelegate(this,this.$9d6);this.$$d_$9SB=Function.createDelegate(this,this.$9SB);this.$$d_$9XN=Function.createDelegate(this,this.$9XN);this.$os=new(_a.$Z.$$(String));_im.$Mx.initializeBase(this);_a.$3.$m(n,"presenceCrossWindowNotifier");this.$1I5=n;this.$os.add_$1Y(this.$$d_$9XN);_js.Trace.logInfo(_a.$0.$Fa,"PresenceRequestsManager.Ctor")};function $4yR(n){if(n.$1sO){_js.Trace.logInfo(_a.$0.$Fa,"PresenceRequestsManager.CancelBatchGetPresenceRequestsTimer.");n.$1sO=_js.$J.get_$I().$5A(n.$1sO)}}_im.$Mx.prototype={$1I5:null,$1sO:null,$5AH:function(n){_a.$3.$1G(n,"sipUri");if(!this.$os.$76(n)){_js.Trace.logInfo(_a.$0.$Fa,"PresenceRequestsManager.AddOrUpdatePendingGetRequests: Queuing a presence retrieval request for sip {0}",n);this.$os.$D(n)}},$9o0:function(n){_a.$3.$1G(n,"sipUri");return this.$os.$34(n)},$7gr:function(){_js.Trace.logInfo(_a.$0.$Fa,"PresenceRequestsManager.ClearAll: Clearing all pending get presence requests: {0}",this.$os.get_$C());this.$os.$1t()},$49:function(){_js.Trace.logInfo(_a.$0.$Fa,"PresenceRequestsManager.InternalDispose.");$4yR(this)},$9d6:function(){this.$1sO=null;var n=this.$os.$6W();var i=n.join("; ");this.$os.$1t();var t=new _im.$17p(n);t.add_$2t(this.$$d_$9SB);OwaApplication.$1W.$11(t)},$9XN:function(n,t){if(this.$os.get_$C()>0){if(!this.$1sO){_js.Trace.logInfo(_a.$0.$Fa,"PresenceRequestsManager.OnPendingGetPresenceRequestsCollectionChanged: Activating timer to run after {0}ms. Current count of pending requests = {1}",_im.$Mx.$4gE,this.$os.get_$C());this.$1sO=_js.$J.get_$I().$1s(_a.$0.$Fa,"GetPresence",this.$$d_$9d6,_im.$Mx.$4gE)}}else{_js.Trace.logInfo(_a.$0.$Fa,"PresenceRequestsManager.OnPendingGetPresenceRequestsCollectionChanged: Cancelling timer. Current count of pending requests = {0}",this.$os.get_$C());$4yR(this)}},$9SB:function(n){var t=n;var i=t.$1W8.join("; ");if(t.$1d){_js.Trace.logWarning(_a.$0.$Fa,"PresenceRequestsManager.OnGetPresenceActionCompleted: Failed with {0} for {1} SipUris: '{2}'",t.$1d,this.$os.get_$C(),i);return}}};_im.$fx=function(n){this.$$d_$9dU=Function.createDelegate(this,this.$9dU);this.$$d_$4QK=Function.createDelegate(this,this.$4QK);this.$$d_$9cT=Function.createDelegate(this,this.$9cT);this.$k=n;this.$1oS=new(_0365f.$n.$$(String));this.$1rE=new(_0365f.$n.$$(String));this.$1Wt=new(_0365f.$n.$$(String))};function $4yS(n){if(n.$1Wt.get_$C()&&!n.$3i4){n.$3i4=!0;var t=n.$1Wt.get_$3o(0);n.$1Wt.$6C(0);n.$1rE.$34(t);var i=new _im.$1Gm(t);i.add_$2t(n.$$d_$9dU);n.$k.$11(i)}}_im.$fx.prototype={$k:null,$1oS:null,$1rE:null,$1Wt:null,$3i4:!1,$5Aj:function(n){for(var i=new(_0365f.$n.$$(String)),f=n.get_$3O(),e=f.length,r=0;r<e;++r){var t=f[r];if(this.$1Wt.$76(t)){this.$1Wt.$34(t);continue}this.$1rE.$76(t)||this.$1oS.$76(t)||i.$76(t)||i.$D(t)}if(i.get_$C()>0){this.$1oS.$6S(i.get_$3O());var u=new _im.$1FG(i.get_$3O());u.add_$29(this.$$d_$9cT);u.add_$21(this.$$d_$4QK);this.$k.$11(u)}},$29x:function(n){for(var i=0;i<n.get_$C();i++){var t=n.get_$3o(i);if(this.$1oS.$76(t)){this.$1oS.$34(t);continue}this.$1Wt.$76(t)||this.$1rE.$76(t)&&this.$1Wt.$D(t)}$4yS(this)},$9dU:function(n){this.$3i4=!1;$4yS(this)},$9cT:function(n){for(var u=n,r=u.$1W8,f=r.length,t=0;t<f;++t){var i=r[t];this.$1rE.$76(i)||this.$1rE.$D(i);this.$1oS.$34(i)}_js.Trace.logInfo(_a.$0.$4c,"SubscribeForPresenceUpdates: succeeded.")},$4QK:function(n){for(var i=n,r=i.$1W8,u=r.length,t=0;t<u;++t){var f=r[t];this.$1oS.$34(f)}var e=i.$1W8.join(";");_js.Trace.logInfo(_a.$0.$4c,"SubscribeForPresenceUpdates: failed to subscribe for: {0}.",e)}};_im.$sx=function(n,t,i,r,u){_a.$3.$1G(n,"source");_a.$3.$1G(t,"sipUri");this.$2C=n;this.$c1=t;this.$7K=i;this.$N4=r;this.$43V=u};_im.$sx.prototype={$2C:null,$c1:null,$7K:null,$N4:0,$43V:!1,toString:function(){return String.format("Source: {0}, Sip: {1}, DisplayName: {2}, Presence: {3}, IsAboutMeOrMyBuddy: {4}",this.$2C,this.$c1,$5(this.$7K)?"":this.$7K,this.$N4,this.$43V)}};_im.$8A=function(){};_im.$8A.$1xZ=function(n){switch(n){case"Away":return 3;case"BeRightBack":return 3;case"Busy":return 4;case"DoNotDisturb":return 6;case"IdleBusy":return 4;case"IdleOnline":return 2;case"None":return 0;case"Offline":return 1;case"Online":return 2;default:return 0}};_im.$8A.$5aF=function(n){switch(n){case 2:return"Online";case 3:return"Away";case 5:return"IdleBusy";case 4:return"Busy";case 6:return"DoNotDisturb";case 1:return"Offline";case 0:default:return"None"}};_im.$8A.$nB=function(n){_a.$3.$1G(n,"imAddress");var t=n.toLowerCase();t.startsWith("sip:")||(t="sip:"+t);return t};_im.$8A.$fu=function(n){_a.$3.$1G(n,"imAddress");var t=n.toLowerCase();t.startsWith("sip:")&&(t=t.substr(4));return t};_im.$Jr=function(n){this.$$d_$2ap=Function.createDelegate(this,this.$2ap);this.$$d_$9US=Function.createDelegate(this,this.$9US);this.$$d_$9ud=Function.createDelegate(this,this.$9ud);this.$$d_$7g2=Function.createDelegate(this,this.$7g2);this.$$d_$9fp=Function.createDelegate(this,this.$9fp);_im.$Jr.initializeBase(this,[n]);_im.$Jr.$433++;this.$3uP=".ChatMouseView#Handler."+_im.$Jr.$433};function $3d7(n){var t=n.$89L();_js.$8.$a(t)||(window.document.title=t)}_im.$Jr.prototype={$3uP:null,$43:null,$Rb:null,$2Mw:null,$7a:null,$89L:function(){if(!this.$7a)return null;if(!_js.$8.$a(this.$7a.get_$2i()))return this.$7a.get_$2i();var t=this.$7a.get_$Qc();var n=t.get_$C();if(n)if(n===1){var i=t.get_$3o(0);return String.format(_nbs.NonBootStrings.l_ChatSubjectOneParticipant_Text,i.get_$1o())}else return String.format(_nbs.NonBootStrings.l_ChatSubjectMultipleParticipants_Text,n);else return null},$Hw:function(){_js.$5.prototype.$Hw.call(this);this.$2Mw.$LQ();this.$43.$pE(100);this.$2ap(null)},$4Oe:function(){_js.$D.prototype.$4Oe.call(this);if(!this.get_$Z()){if(this.$7a){this.$7a.get_$Qc().remove_$1Y(this.$$d_$9fp);this.$7a.$q(_h.$1e.$Zd.$1k,this.$$d_$7g2)}this.$7a=null;return}var n=this.get_$Z();this.$7a=n.$7a;this.$7a.get_$Qc().add_$1Y(this.$$d_$9fp);this.$7a.$Y(_h.$1e.$Zd.$1k,this.$$d_$7g2);this.$7a.$Y(_h.$1e.$2fJ.$1k,this.$$d_$9ud)},$4H:function(){_js.$5.prototype.$4H.call(this);if(!this.$e){this.$Rb.$q(_b.$6y.$2Q8.$1k,this.$$d_$9US);$(window).unbind(this.$3uP);this.$Rb=null;this.$43=null;this.$2Mw=null;return}this.$43=this.$e.$10("TranscriptScrollRegion");this.$Rb=this.$e.$10("TranscriptLabel");this.$2Mw=this.$e.$10("Editor");this.$Rb.$Y(_b.$6y.$2Q8.$1k,this.$$d_$9US);$(window).bind("resize"+this.$3uP,this.$$d_$2ap);$3d7(this);this.$2Mw.$4au()},$9fp:function(n,t){$3d7(this)},$7g2:function(n,t){$3d7(this)},$9ud:function(n,t){if(this.$7a.get_$2fI()){var i=this.$2Mw.get_$H().children("textarea");i.length>0&&i[0].setAttribute("disabled","true")}},$9US:function(n,t){var i=this.$43.get_$H();var r=i.prop("scrollHeight");i.scrollTop(r-i.height())},$2ap:function(n){var t=$(window).height();t>=425&&this.$43.get_$H().height(251+t-425)}};_im._TI=function(){};_im._TI.$$cctor=function(){new _A("ChatMouseView",function(){_im._TI.$0.ChatMouseView===undefined&&(_im._TI.$0.ChatMouseView=[null,[[-1,0,["ParticipantsViewModel"],[_im._TI.$8lL],null,"DataContext",null,_im._TI.$O,1,null,null,null]],null,[[-1,0,["Chat","BodyText"],[_im._TI.$3Ce,_im._TI.$8ht],null,"Html",null,_im._TI.$GC,1,null,null,null]],[[-1,0,["Chat","LastMessageAriaLabel"],[_im._TI.$3Ce,_im._TI.$5yU],null,"Text",null,_im._TI.$2WT,1,null,null,null],[-1,0,["Chat","LastMessageAriaLabel"],[_im._TI.$3Ce,_im._TI.$5yU],null,"AriaLabel",null,_im._TI.$1E,1,null,null,null]],[[-1,0,["Chat","Status"],[_im._TI.$3Ce,_im._TI.$8hu],null,"Html",null,_im._TI.$GC,1,null,null,null]],[[-1,4,null,null,null,"EditorAriaLabel",null,_im._TI.$1Fp,0,null,null,null,_u.Strings.l_IM_AT_Textbox_Text],[-1,0,["SendCommand"],[_im._TI.$8lN],null,"EnterCommand",null,_im._TI.$8eg,1,null,null,null],[-1,0,["GetEditorContentCommand"],[_im._TI.$8lK],_im._TI.$8lP,"GetContentCommand",_im._TI.$zJ,_im._TI.$zL,2,null,null,null],[-1,0,["SendText"],[_im._TI.$8lO],_im._TI.$8lR,"Content",_im._TI.$zI,_im._TI.$zK,2,null,null,null],[-1,0,["RawEditorContent"],[_im._TI.$8lM],_im._TI.$8lQ,"RawContent",_im._TI.$8ef,_im._TI.$3Bs,2,null,null,null]]]);var n=_im._TI._hf.childNodes[0].cloneNode(!0);var t=new _z.$8G(_B.$2(n,[0,3]),_js.$2.Instance.$2AC(_y.$N),_js.$2.Instance.$2AC(_b.$P5));t.set_$1vk("_im_8");t.set_$204(!1);t.set_$7vk(!0);var f=new _b.$6y(_B.$2(n,[0,2,0]));var e=new _b.$Xo(_B.$2(n,[0,1,1]),_js.$2.Instance.$2AC(_0365f.$L));var i=new _b.$6y(_B.$2(n,[0,1,0]));var r=new _o365c.$1h(_B.$2(n,[0,1]),_js.$2.Instance.$2AC(_js.$1o),_js.$2.Instance.$2AC(_0365f.$b),_js.$2.Instance.$2AC(_0365f.$L));var u=new _js.$5(_B.$2(n,[0,0,0,0]));u.set_$4("ReadOnlyRecipientWellView");var o=new _o365c.$1h(_B.$2(n,[0,0,0]),_js.$2.Instance.$2AC(_js.$1o),_js.$2.Instance.$2AC(_0365f.$b),_js.$2.Instance.$2AC(_0365f.$L));return new _B(n,[o,u,r,i,e,f,t]).R({TranscriptScrollRegion:r,TranscriptLabel:i,Editor:t})},_im.$HP,_im.$Jr,!1,!1,!1,0,_im._TI.$0)};_im._TI.$9A=function(){var n=window.document.createElement("DIV");n.innerHTML="<div> <div class='_im_2'> <div class='_im_3'> <div class='_im_4'> <div></div> </div> </div> <div class='_im_5'> <span></span> <div></div> </div> <div class='_im_6'> <span></span> </div> <div class='_im_7'></div> </div> </div>";_js.$D.get_$8r().appendChild(n);return n};_im._TI.$8lL=function(n){return n.get_$28S()};_im._TI.$3Ce=function(n){return n.$7a};_im._TI.$8ht=function(n){return n.get_$1Z6()};_im._TI.$5yU=function(n){return n.get_$5oD()};_im._TI.$8hu=function(n){return n.get_$Az()};_im._TI.$8lN=function(n){return n.$E4};_im._TI.$8lK=function(n){return n.$J8};_im._TI.$zJ=function(n){return n.$14b};_im._TI.$8lO=function(n){return n.get_$2fB()};_im._TI.$zI=function(n){return n.$CY};_im._TI.$8lM=function(n){return n.$4V1};_im._TI.$8ef=function(n){return n.get_$3NY()};_im._TI.$O=function(n,t){n.set_$Z(t)};_im._TI.$GC=function(n,t){n.set_$g2(t)};_im._TI.$2WT=function(n,t){n.set_$1Q(t)};_im._TI.$1E=function(n,t){n.set_$8T(t)};_im._TI.$8eg=function(n,t){n.set_$J5(t)};_im._TI.$8lP=function(n,t){n.$J8=t};_im._TI.$zL=function(n,t){n.set_$2O7(t)};_im._TI.$8lR=function(n,t){n.set_$2fB(t)};_im._TI.$zK=function(n,t){n.set_$CZ(t)};_im._TI.$8lQ=function(n,t){n.set_$Nu(t)};_im._TI.$3Bs=function(n,t){n.set_$3NY(t)};_im._TI.$1Fp=function(n,t){n.$1O3=t};IMComponent.registerClass("IMComponent",null,_a.$1L9);_im.$ox.registerClass("_im.$ox");_im.$HP.registerClass("_im.$HP",_a.$FF);_im.$oy.registerClass("_im.$oy",null,IChatViewModelFactory,_y.$19p);_im.$1F7.registerClass("_im.$1F7",null,_h.$yo);_im.$12Y.registerClass("_im.$12Y",_h.$FG.$$(Number));_im.$14B.registerClass("_im.$14B",null,IChatActionFactory);_im.$162.registerClass("_im.$162",_h.$FG.$$(Boolean));_im.$163.registerClass("_im.$163");_im.$17p.registerClass("_im.$17p",_h.$FG.$$(Number));_im.$19R.registerClass("_im.$19R",_h.$FG.$$(Number));_im.$19S.registerClass("_im.$19S",_h.$FG.$$(Number));_im.$1DZ.registerClass("_im.$1DZ",_h.$FG.$$(Number));_im.$1E7.registerClass("_im.$1E7",_h.$FG.$$(Number));_im.$1Ef.registerClass("_im.$1Ef",_h.$FG.$$(Number));_im.$n5.registerClass("_im.$n5",_a.$2X);_im.$11f.registerClass("_im.$11f");_im.$1FG.registerClass("_im.$1FG",_h.$FG.$$(Number));_im.$1Gm.registerClass("_im.$1Gm",_h.$FG.$$(Number));_im.$b2.registerClass("_im.$b2");_im.$2b.registerClass("_im.$2b",_js.$9,IChatManager,_js.$yO);_im.$14C.registerClass("_im.$14C",null,IChatManagerFactory);_im.$EG.registerClass("_im.$EG",_js.$9);_im.$14D.registerClass("_im.$14D",_js.$9);_im.$14E.registerClass("_im.$14E",null,IChatProvider);_im.$14F.registerClass("_im.$14F",null,IChatProviderFactory);_im.$Ht.registerClass("_im.$Ht",_js.$15l,IPresenceManager);_im.$10T.registerClass("_im.$10T",_im.$Ht);_im.$Mx.registerClass("_im.$Mx",_js.$15l);_im.$1Co.registerClass("_im.$1Co",_im.$Mx);_im.$fx.registerClass("_im.$fx");_im.$sx.registerClass("_im.$sx");_im.$8A.registerClass("_im.$8A");_im.$Jr.registerClass("_im.$Jr",_js.$5);_im._TI.registerClass("_im._TI");_im.$HP.$4Zp=new _H("SendText",String,_im.$HP,"");_im.$HP.$4Rx=new _H("ParticipantsViewModel",_y.$2W,_im.$HP);_im.$2b.$3Te="SignInState";_im.$2b.$5lq="IsSignedIn";_im.$2b.$2cN="Presence";_im.$Ht.$w=null;_im.$Mx.$4gE=5e3;_im.$Jr.$433=0;_im._TI._hf=_im._TI.$9A();_im._TI.$0={};_im._TI.$$cctor()